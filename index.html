<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>大三班通讯录更新</title>
    <link rel="stylesheet" href="layui/css/layui.css">
    <style>
        body {
            background: url('timg.jpg');
            background-size: cover;
            background-repeat: no-repeat;
        }

        .form_box {
            margin: 20px 10px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.411)
        }

        body .layui-layer-demo .layui-layer-title {
            background: #009688;
            color: #fff;
            border: none;
        }
    </style>
</head>

<body>
    <div id='app'>
        <div class="form_box" v-show='isLogin'>
            <form class="layui-form layui-form-pane" action="">
                <div class="layui-form-item">
                    <label class="layui-form-label">姓名(必填)</label>
                    <div class="layui-input-block">
                        <input type="text" name="username" required lay-verify="required" placeholder="请输入姓名" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">电话(必填)</label>
                    <div class="layui-input-block">
                        <input type="tel" name="mobile" required lay-verify="required|phone" placeholder="请输入电话" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">邮箱(必填)</label>
                    <div class="layui-input-block">
                        <input type="text" name="email" required lay-verify="required|email" placeholder="请输入邮箱" autocomplete="off" class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">专业</label>
                    <div class="layui-input-block">
                        <select name="major" lay-verify="required">
                            <option value="0">资环</option>
                            <option value="1" selected>GIS</option>
                        </select>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">性别</label>
                    <div class="layui-input-block">
                        <input type="radio" name="sex" value="男" title="男">
                        <input type="radio" name="sex" value="女" title="女" checked>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">工作单位</label>
                    <div class="layui-input-block">
                        <input type="text" name="job" placeholder="请输入工作单位" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item layui-form-text">
                    <label class="layui-form-label">联系地址</label>
                    <div class="layui-input-block">
                        <textarea name="address" placeholder="请输入联系地址" class="layui-textarea"></textarea>
                    </div>
                </div>
                <div class="layui-form-item layui-form-text">
                    <label class="layui-form-label">备注</label>
                    <div class="layui-input-block">
                        <textarea name="notice" placeholder="有啥想对小编说的可以写在这里哦" class="layui-textarea"></textarea>
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-input-block">
                        <button class="layui-btn" lay-submit lay-filter="formDemo">提交</button>
                        <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                    </div>
                </div>
            </form>
        </div>
        <div id='login' v-if='!isLogin'>
            <form class="layui-form layui-form-pane" action="">
                <div class="layui-form-item">
                    <label class="layui-form-label">姓名</label>
                    <div class="layui-input-block">
                        <input type="text" name="username" required lay-verify="required" placeholder="请输入姓名" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">电话</label>
                    <div class="layui-input-block">
                        <input type="tel" name="mobile" @change='needCode = false' required lay-verify="required|phone" placeholder="请输入手机号码" autocomplete="off"
                            class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item" v-if='needCode'>
                    <label class="layui-form-label">验证码</label>
                    <div class="layui-input-inline">
                        <input type="tel" name="code" @change='needCode = false' required lay-verify="required|number" placeholder="请输入验证码" autocomplete="off"
                            class="layui-input">
                    </div>
                    <button>获取验证码</button>
                </div>
                <div class="layui-form-item">
                    <div class="layui-input-block">
                        <button class="layui-btn" lay-submit lay-filter="formLogin">登录</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <script src="layui/vue.min.js"></script>
    <!-- 你的HTML代码 -->
    <script src="layui/layui.js"></script>

</body>
<script>
    //一般直接写在一个js文件中
    layui.use(['layer', 'form'], function () {
        var layer = layui.layer,
            form = layui.form,
            $ = layui.$;

        var vm = new Vue({
            el: '#app',
            data: {
                isLogin: false,
                loginLayer: ''
            },
            created: function () {
                var _this = this;
                this.loginLayer = layer.open({
                    type: 1,
                    closeBtn: 0, //不显示关闭按钮
                    anim: 2,
                    title: '登录',
                    skin: 'layui-layer-demo',
                    shadeClose: false, //开启遮罩关闭
                    content: $('#login'),
                    area: '350px'
                })

                //监听提交
                form.on('submit(formDemo)', function (data) {
                    layer.msg(JSON.stringify(data.field));
                    return false;
                });

                //监听提交
                form.on('submit(formLogin)', function (data) {

                    _this.login(data.field)

                    return false;
                });
            },
            methods: {
                login: function (params) {
                    _this = this;
                    var loadingIndex = layer.load(1, {
                        shade: [0.2, '#fff'] //0.1透明度的白色背景
                    });
                    $.ajax({
                        type: 'POST',
                        url: '/collect/login.php',
                        data: params,
                        success: function (res) {
                            layer.close(loadingIndex)
                            console.log(res)
                            var res = JSON.parse(res)
                            if (res.status == 1) {
                                _this.isLogin = true;
                                layer.close(_this.loginLayer);
                                layer.msg('Hi,' + params.username + '，好久不见，最近过得怎么样^_^');
                            } else if (res.status == 0) {
                                layer.msg(res.msg);
                                _this.needCode = true;
                            } else {
                                layer.msg('未知错误，请联系mo');
                            }

                        },
                        error: function (error) {
                            layer.close(loadingIndex)
                            layer.msg('未知错误，请联系mo');
                        }
                    })
                },
                update: function (params) {
                    _this = this;
                    var loadingIndex = layer.load(1, {
                        shade: [0.2, '#fff'] //0.1透明度的白色背景
                    });
                    $.ajax({
                        type: 'POST',
                        url: '/collect/update.php',
                        data: params,
                        success: function (res) {
                            layer.close(loadingIndex)
                            console.log(res)
                            var res = JSON.parse(res)
                            if (res.status == 1) {
                                layer.msg(res.msg);
                            } else {
                                layer.msg(res.msg);
                            }

                        },
                        error: function (error) {
                            layer.close(loadingIndex)
                            layer.msg('未知错误，请联系mo');
                        }
                    })
                }
            }

        })
    });


</script>

</html>